@{
    ViewData["Title"] = "Online IDE";
}

<div class="container">
    <h2>Online IDE</h2>
    <div class="row">
        <div class="col-md-8">
            <div id="editor" style="height: 400px; border: 1px solid grey;"></div>
        </div>
        <div class="col-md-4">
            <button id="runButton" class="btn btn-primary mb-3">Run Code</button>
            <div id="output" style="height: 350px; border: 1px solid grey; overflow-y: auto; padding: 10px;"></div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs' } });
        require(['vs/editor/editor.main'], function () {
            var editor = monaco.editor.create(document.getElementById('editor'), {
                value: '# Write your Python code here\nprint("Hello, World!")',
                language: 'python',
                theme: 'vs-dark'
            });

            document.getElementById('runButton').addEventListener('click', function () {
                var code = editor.getValue();
                var outputElement = document.getElementById('output');
                outputElement.innerText = 'Running code...';

                console.log('Sending code to server:', code);

                fetch('/OnlineIDE/RunCode', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ code: code, language: 'python' }),
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Received data:', data);
                        if (data.success) {
                            console.log('Raw output:', data.output);
                            // Clean up the output
                            var cleanOutput = data.output.replace(/^\s*[\u0000-\u001F\u007F-\u009F]+/, '').trim();
                            console.log('Clean output:', cleanOutput);
                            // Convert whitespace to visible characters (optional)
                            var visibleOutput = cleanOutput.replace(/\n/g, '↵\n').replace(/ /g, '·');
                            console.log('Visible output:', visibleOutput);
                            outputElement.innerText = cleanOutput; // or visibleOutput if you want to keep whitespace visible
                        } else {
                            console.log('Error output:', data.output);
                            outputElement.innerText = 'Error: ' + data.output;
                        }
                        console.log('Output element text:', outputElement.innerText);
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                        outputElement.innerText = 'An error occurred while running the code.';
                    });
            });
        });
    </script>
}